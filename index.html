<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì–‘ìì—­í•™ ë§ˆìŠ¤í„° âš›ï¸</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš›ï¸</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                enableMenu: false // ë©”ë‰´ë¥¼ êº¼ì„œ í„°ì¹˜ ê°„ì„­ ë°©ì§€
            },
            chtml: {
                scale: 0.9, // ì „ì²´ì ì¸ ìˆ˜ì‹ í¬ê¸°ë¥¼ ì‚´ì§ ì¤„ì„
                minScale: 0.5 // í™”ë©´ì´ ì‘ì•„ì§€ë©´ ìµœëŒ€ 50%ê¹Œì§€ ì¤„ì–´ë“¦
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #455a64;
            --accent: #ffab91;
            --text-color: #37474f;
            --btn-bg: #ffffff;
            --btn-shadow: #cfd8dc;
            --speaker-btn: #ffcc80;
            --color-correct: #43a047;
            --color-incorrect: #e53935;
            --color-actual: #1e88e5;
        }

        body { 
            font-family: 'Nanum Gothic', sans-serif; 
            background: var(--bg-gradient); 
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            touch-action: manipulation;
        }

        #game-container { 
            background: var(--card-bg); 
            padding: 15px; border-radius: 35px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 95%; max-width: 450px; 
            height: 90vh;
            display: flex; flex-direction: column; 
            border: 6px solid #fff; box-sizing: border-box;
            position: relative; text-align: center;
        }

        .header { flex-shrink: 0; margin-bottom: 5px; }
        .mode-badge {
            display: inline-block; padding: 6px 20px; border-radius: 50px;
            font-size: 14px; font-weight: bold; margin-bottom: 5px;
            color: white; background: var(--primary);
        }

        /* ğŸ’¡ ìˆ˜ì‹ í‘œì‹œ ì˜ì—­ ê°œì„ : ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ + í°íŠ¸ ê°€ë³€ */
        #word-display { 
            font-size: 1.2rem;
            color: #333; flex-grow: 1;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: #f8f9fa; border-radius: 20px; margin: 10px 0;
            padding: 15px; position: relative; border: 1px inset #eee;
            overflow-x: auto; /* ì¢Œìš° ìŠ¤í¬ë¡¤ í—ˆìš© */
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
        }

        #equation-box {
            width: 100%;
            max-width: 100%;
        }

        .speaker-btn {
            position: absolute; bottom: 8px; right: 8px;
            background: var(--speaker-btn); border: none; border-radius: 50%;
            width: 44px; height: 44px; cursor: pointer;
            box-shadow: 0 4px 0px #ffb74d; display: flex; align-items: center; justify-content: center;
            font-size: 20px; z-index: 10;
        }

        #feedback-area {
            min-height: 90px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        #feedback { 
            font-family: 'Nanum Pen Script', cursive; font-size: 20px;
            text-align: center; word-break: keep-all; line-height: 1.2;
            margin-bottom: 5px;
        }

        #next-btn {
            background: #c8e6c9; font-size: 14px; padding: 8px 25px;
            border-radius: 50px; box-shadow: 0 4px 0px #a5d6a7;
            color: #2e7d32; font-weight: bold; border: none; cursor: pointer;
            visibility: hidden;
        }

        .options-grid { 
            display: grid; gap: 8px; 
            grid-template-columns: 1fr;
            flex-shrink: 0; padding: 5px; margin-bottom: 10px;
        }
        
        button.option-btn { 
            padding: 12px 8px; font-size: 14px; cursor: pointer; 
            border: none; border-radius: 12px; 
            background: var(--btn-bg); color: var(--text-color);
            box-shadow: 0 4px 0px var(--btn-shadow);
            transition: all 0.2s; word-break: keep-all;
        }
        
        button.btn-correct { background-color: var(--color-correct) !important; color: white !important; box-shadow: 0 4px 0px #2e7d32 !important; }
        button.btn-incorrect { background-color: var(--color-incorrect) !important; color: white !important; box-shadow: 0 4px 0px #b71c1c !important; }
        button.btn-actual { background-color: var(--color-actual) !important; color: white !important; box-shadow: 0 4px 0px #0d47a1 !important; }

        #score-display { 
            font-size: 12px; color: #78909c;
            background: #fff; padding: 6px; border-radius: 15px;
            display: flex; justify-content: space-around;
            border: 1px solid #eceff1; flex-shrink: 0;
        }

        .result-screen { display: none; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
        .btn-action { color: white; font-weight: bold; margin-top: 10px; width: 100%; padding: 14px; border-radius: 20px; border: none; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="quiz-screen" style="height: 100%; display: flex; flex-direction: column;">
            <div class="header">
                <div id="mode-indicator" class="mode-badge">ì–‘ìì—­í•™ ë§ˆìŠ¤í„° âš›ï¸</div>
            </div>

            <div id="word-display">
                <div id="equation-box">\( ... \)</div>
                <button class="speaker-btn" onclick="readEquation()">ğŸ”Š</button>
            </div>

            <div id="feedback-area">
                <div id="feedback"></div>
                <button id="next-btn" onclick="goToNextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¯</button>
            </div>

            <div id="options" class="options-grid"></div>
            
            <div id="score-display">
                <span>ğŸ“ <span id="current-q-num">1</span>/7</span>
                <span>â­ <span id="correct-q-num">0</span></span>
            </div>
        </div>

        <div id="result-screen" class="result-screen">
            <span style="font-size: 50px;">ğŸ“</span>
            <h2 id="result-title">í•™ìŠµ ì™„ë£Œ!</h2>
            <p id="result-stats" style="font-size: 18px; color: #546e7a;"></p>
            <button onclick="startGame()" class="btn-action" style="background:var(--primary);">âœ¨ ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
            <button id="retry-failed-btn" onclick="startRetryMode()" class="btn-action" style="background:var(--accent);">ğŸ” í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œí’€ê¸°</button>
        </div>
    </div>

<script>
    const physicsData = [
        {name: "í”Œë‘í¬ ë²•ì¹™", eq: "\\[ I(\\nu, T) = \\frac{2h\\nu^3}{c^2} \\frac{1}{e^{\\frac{h\\nu}{kT}} - 1} \\]", read: "I of nu and T equals two h nu cubed over c squared, times one over e to the power of h nu over k T, minus one.", author: "ë§‰ìŠ¤ í”Œë‘í¬", year: "1900", desc: "í‘ì²´ ë³µì‚¬ ì—ë„ˆì§€ ë¶„í¬ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤."},
        {name: "ê´‘ì „íš¨ê³¼ ê³µì‹", eq: "\\[ E_k = hf - W \\]", read: "E sub k equals h f minus W.", author: "ì•Œë² ë¥´íŠ¸ ì•„ì¸ìŠˆíƒ€ì¸", year: "1905", desc: "ë¹›ì˜ ì…ìì„±(ê´‘ì)ì„ ì¦ëª…í•©ë‹ˆë‹¤."},
        {name: "ìˆ˜ì†Œ ì›ì ëª¨ë¸", eq: "\\[ h\\nu = E_m - E_n \\]", read: "h nu equals delta E, which is E sub m minus E sub n.", author: "ë‹ìŠ¤ ë³´ì–´", year: "1913", desc: "ì—ë„ˆì§€ ì¤€ìœ„ì™€ ì–‘ì ë„ì•½ì„ ì„¤ëª…í•©ë‹ˆë‹¤."},
        {name: "ë¶ˆí™•ì •ì„± ì›ë¦¬", eq: "\\[ \\Delta x \\Delta p \\geq \\frac{\\hbar}{2} \\]", read: "Delta x delta p is greater than or equal to h-bar over two.", author: "ë² ë¥´ë„ˆ í•˜ì´ì  ë² ë¥´í¬", year: "1927", desc: "ìœ„ì¹˜ì™€ ìš´ë™ëŸ‰ì˜ ë™ì‹œ ì¸¡ì • ë¶ˆê°€ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."},
        {name: "ìŠˆë¢°ë”©ê±° ë°©ì •ì‹", eq: "\\[ i\\hbar \\frac{\\partial}{\\partial t} |\\psi(t)\\rangle = \\hat{H} |\\psi(t)\\rangle \\]", read: "i h-bar, partial psi partial t, equals H-hat psi.", author: "ì—ë¥´ë¹ˆ ìŠˆë¢°ë”©ê±°", year: "1925", desc: "ì–‘ì ìƒíƒœì˜ ì‹œê°„ì  ë³€í™”ë¥¼ ê¸°ìˆ í•©ë‹ˆë‹¤."},
        {name: "ë””ë™ ë°©ì •ì‹", eq: "\\[ (-i\\eth + m)\\psi = 0 \\]", read: "Minus i d-slash plus m, acting on psi, equals zero.", author: "í´ ë””ë™", year: "1928", desc: "ìƒëŒ€ë¡ ì  ì–‘ìì—­í•™ê³¼ ë°˜ë¬¼ì§ˆì„ ì„¤ëª…í•©ë‹ˆë‹¤."},
        {name: "ë²¨ì˜ ë¶€ë“±ì‹", eq: "\\[ 1 + C(b, c) \\geq |C(a, b) - C(a, c)| \\]", read: "One plus C of b and c is greater than or equal to the absolute value of C of a and b minus C of a and c.", author: "ì¡´ ìŠ¤íŠœì–´íŠ¸ ë²¨", year: "1964", desc: "ì–‘ì ì–½í˜ì˜ ë¹„êµ­ì†Œì„±ì„ íŒë³„í•©ë‹ˆë‹¤."}
    ];

    let currentQuizSet = [], currentIdx = 0, correctCount = 0, failedQuestions = [], isReviewMode = false;

    function playSound(isCorrect) {
        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (isCorrect) {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, now);
                oscillator.frequency.setValueAtTime(659.25, now + 0.1);
                oscillator.frequency.setValueAtTime(783.99, now + 0.2);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                oscillator.start(now);
                oscillator.stop(now + 0.5);
            } else {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(220, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        } catch(e) { console.log("Audio not supported"); }
    }

    function readEquation() {
        const q = currentQuizSet[currentIdx];
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(q.read);
        utterance.lang = 'en-US';
        utterance.rate = 0.7; // ì¡°ê¸ˆ ë” ì²œì²œíˆ
        
        const voices = window.speechSynthesis.getVoices();
        const femaleVoice = voices.find(v => v.name.includes('Female') || v.name.includes('Google US English') || v.name.includes('Zira'));
        if (femaleVoice) utterance.voice = femaleVoice;
        
        window.speechSynthesis.speak(utterance);
    }

    function startGame() {
        isReviewMode = false; failedQuestions = [];
        currentQuizSet = [...physicsData].sort(() => Math.random() - 0.5);
        resetState();
    }

    function startRetryMode() {
        isReviewMode = true;
        currentQuizSet = [...failedQuestions].sort(() => Math.random() - 0.5);
        failedQuestions = [];
        resetState();
    }

    function resetState() {
        currentIdx = 0; correctCount = 0;
        document.getElementById('mode-indicator').innerText = isReviewMode ? "í‹€ë¦° ë¬¸ì œ ë³µìŠµ ğŸ”" : "ì–‘ìì—­í•™ ë§ˆìŠ¤í„° âš›ï¸";
        document.getElementById('quiz-screen').style.display = 'flex';
        document.getElementById('result-screen').style.display = 'none';
        hideFeedback();
        renderQuestion();
    }

    function hideFeedback() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.visibility = 'hidden';
    }

    function renderQuestion() {
        if (currentIdx >= currentQuizSet.length) { showResult(); return; }
        const q = currentQuizSet[currentIdx];
        
        const eqBox = document.getElementById('equation-box');
        eqBox.innerHTML = q.eq;
        
        // MathJax ë Œë”ë§ í›„ ì™„ë£Œ ì‹œì  ì²˜ë¦¬
        MathJax.typesetPromise().then(() => {
            // ìˆ˜ì‹ ë Œë”ë§ ì™„ë£Œ í›„ í•„ìš”í•œ ì²˜ë¦¬
        });

        document.getElementById('current-q-num').innerText = currentIdx + 1;
        document.getElementById('correct-q-num').innerText = correctCount;

        const correctAnswer = `${q.author}ì˜ ${q.name}`;
        let options = [correctAnswer];
        let others = physicsData.filter(item => item.name !== q.name).sort(() => Math.random() - 0.5);
        for(let i=0; i < 3; i++) { if(others[i]) options.push(`${others[i].author}ì˜ ${others[i].name}`); }
        options.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, correctAnswer, q);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedBtn, selectedText, correctText, qObj) {
        const allBtns = document.querySelectorAll('#options button');
        allBtns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('feedback');
        
        if (selectedText === correctText) {
            playSound(true);
            selectedBtn.classList.add('btn-correct');
            feedback.innerHTML = `<span style="color:var(--color-correct)">âœ¨ ì •ë‹µ! âœ¨<br><strong>${qObj.year}ë…„</strong>: ${qObj.desc}</span>`;
            correctCount++;
        } else {
            playSound(false);
            selectedBtn.classList.add('btn-incorrect');
            allBtns.forEach(b => {
                if (b.innerText === correctText) b.classList.add('btn-actual');
            });
            feedback.innerHTML = `<span style="color:var(--color-incorrect)">ì•„ì‰¬ì›Œìš”! íŒŒë€ìƒ‰ì´ ì •ë‹µì…ë‹ˆë‹¤.</span>`;
            if (!failedQuestions.some(item => item.name === qObj.name)) failedQuestions.push(qObj);
        }
        document.getElementById('next-btn').style.visibility = 'visible';
    }

    function goToNextQuestion() {
        currentIdx++;
        hideFeedback();
        renderQuestion();
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('result-stats').innerText = `${currentQuizSet.length}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì„±ê³µ!`;
        document.getElementById('retry-failed-btn').style.display = failedQuestions.length > 0 ? 'block' : 'none';
    }

    window.onload = startGame;
    window.speechSynthesis.onvoiceschanged = () => {};
</script>
</body>
</html>
